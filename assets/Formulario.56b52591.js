import{a as m,o as c,c as d,b as a,t as u,d as y,s,z as w,u as o,A as p,k as f,i as h,F as v,p as _,e as D}from"./index.dac24cdc.js";const P={class:"container"},z={class:"mb-2"},E={class:"label"},A=["placeholder","value"],g=m({__name:"BaseInput",props:{label:{type:String,default:""},modelValue:{type:[String,Number],default:""}},setup(t){return(e,r)=>(c(),d("div",P,[a("div",z,[a("label",E,u(t.label),1),a("input",{type:"text",class:"input input-bordered input-accent w-full max-w-md",placeholder:t.label,value:t.modelValue,onInput:r[0]||(r[0]=i=>e.$emit("update:modelValue",i.target.value))},null,40,A)])]))}}),V=y({id:"form",state:()=>({productos:[],size:"16em",uploading:!1,loading:!1,src:"",files:null,filePath:null,error:null,editar:!1,urlDescarga:{},producto:{id:"",title:"",price:0,description:"",image:""}}),actions:{async obtenerDatos(){try{const{data:t,error:e}=await s.from("elementos").select("*").order("id");if(e){console.log("error",e);return}if(t===null){this.productos=[];return}this.productos=t,console.log("Productos ",this.productos)}catch(t){console.error("Error retrieving data from db",t)}},async obtenerDatoId(t){try{const{data:e,error:r}=await s.from("elementos").select("id, title, description, price").eq("id",t).single();if(r){console.log("error",r);return}e===null&&(this.productos=[]),this.producto=e,console.log("Producto ",this.producto)}catch(e){console.error("Error retrieving data from db",e)}},async eliminarDato(t){try{await s.from("elementos").delete().eq("id",t),console.log("Dato eliminado",t)}catch(e){console.error("error",e)}},async agregarDato(){this.loading=!0;try{const t={title:this.producto.title,price:this.producto.price,description:this.producto.description,image:this.urlDescarga},{data:e,error:r}=await s.from("elementos").insert(t).single();return r?(alert(r),console.error("There was an error inserting",r.message),null):(console.log("Nuevo producto creado"),e)}catch(t){return alert("Error"),console.error("Unknown problem inserting to db",t),null}finally{this.loading=!1}},async actualizarDatoCampo(t,e){try{const{error:r}=await s.from("elementos").update({is_complete:e}).eq("id",t.id).single();if(r){alert(r.message),console.error("There was an error updating",r);return}console.log("Dato validado",t.id)}catch(r){alert("Error"),console.error("Unknown problem updating record",r)}},async actualizarDato(){this.loading=!0;try{const t={id:this.producto.id,title:this.producto.title,price:this.producto.price,description:this.producto.description,image:this.urlDescarga},{error:e}=await s.from("elementos").upsert(t,{returning:"minimal"});if(e)throw e}catch(t){alert(t)}finally{this.loading=!0}},async subirArchivoAgregar(t){var e;this.files=t.target.files;try{if(this.uploading=!0,!this.files||this.files.length===0)throw new Error("You must select an image to upload.");const r=this.files[0],i=r.name.split(".").pop(),l=`${Math.random()}.${i}`;this.filePath=`${l}`,console.log("filePath ",this.filePath);const{error:n}=await s.storage.from("avatars").upload(this.filePath,r);if(n)throw n;this.urlDescarga=await((e=s.storage.from("avatars").getPublicUrl(l).data)==null?void 0:e.publicURL),console.log("urlDescarga",this.urlDescarga),this.downloadImage(),this.agregarDato()}catch(r){alert(r)}finally{this.uploading=!1}},async subirArchivoActualizar(t){var e;this.files=t.target.files;try{if(this.uploading=!0,!this.files||this.files.length===0)throw new Error("You must select an image to upload.");const r=this.files[0],i=r.name.split(".").pop(),l=`${Math.random()}.${i}`;this.filePath=`${l}`,console.log("filePath ",this.filePath);const{error:n}=await s.storage.from("avatars").upload(this.filePath,r);if(n)throw n;this.urlDescarga=await((e=s.storage.from("avatars").getPublicUrl(l).data)==null?void 0:e.publicURL),console.log("urlDescarga",this.urlDescarga),this.downloadImage(),this.actualizarDato()}catch(r){alert(r)}finally{this.uploading=!1}},async downloadImage(){try{const{data:t,error:e}=await s.storage.from("avatars").download(this.filePath);if(console.log("donwnload",this.filePath),e)throw e;this.src=URL.createObjectURL(t),console.log("src ",this.src)}catch(t){console.error("Error downloading image: ",t)}}}}),k={class:"w-full h-full flex flex-col justify-center items-center p-4"},x=["src"],$={key:0,class:"flex content-center btn btn-wide btn-accent",for:"single"},U=["disabled"],C={key:1,class:"flex content-center btn btn-accent",for:"single"},I=["disabled"],N={class:"table"},F=a("thead",null,[a("tr",null,[a("th",{scope:"col"},"id"),a("th",{scope:"col"},"Title"),a("th",{scope:"col"},"Price"),a("th",{scope:"col"},"Editar"),a("th",{scope:"col"},"Eliminar")])],-1),L={scope:"row"},S=["onClick"],B=["onClick"],R=m({__name:"Formulario",setup(t){const e=V();return w(()=>{e.obtenerDatos()}),(r,i)=>(c(),d("div",k,[a("form",null,[a("div",null,[o(e).src?(c(),d("img",{key:0,src:o(e).src,class:"avatar rounded mb-2",style:p({height:o(e).size,width:o(e).size})},null,12,x)):(c(),d("div",{key:1,class:"avatar bg-gray-500 bg-opacity-100 rounded-lg",style:p({height:o(e).size,width:o(e).size})},null,4)),a("div",{style:p({width:o(e).size})},[o(e).editar===!1?(c(),d("label",$,[f(u(o(e).uploading?"Guardando ...":"Guardar")+" ",1),a("input",{style:{visibility:"hidden",position:"absolute"},type:"file",id:"single",accept:"image/*",onChange:i[0]||(i[0]=(...l)=>o(e).subirArchivoAgregar&&o(e).subirArchivoAgregar(...l)),disabled:o(e).uploading},null,40,U)])):(c(),d("label",C,[f(u(o(e).uploading?"Actualizando ...":"Actualizar")+" ",1),a("input",{style:{visibility:"hidden",position:"absolute"},type:"file",id:"single",accept:"image/*",onChange:i[1]||(i[1]=(...l)=>o(e).subirArchivoActualizar&&o(e).subirArchivoActualizar(...l)),disabled:o(e).uploading},null,40,I)]))],4)]),h(g,{modelValue:o(e).producto.title,"onUpdate:modelValue":i[2]||(i[2]=l=>o(e).producto.title=l),type:"text",label:"Producto"},null,8,["modelValue"]),h(g,{modelValue:o(e).producto.price,"onUpdate:modelValue":i[3]||(i[3]=l=>o(e).producto.price=l),type:"text",label:"Precio"},null,8,["modelValue"]),h(g,{modelValue:o(e).producto.description,"onUpdate:modelValue":i[4]||(i[4]=l=>o(e).producto.description=l),type:"text",label:"Descripci\xF3n"},null,8,["modelValue"])]),a("table",N,[F,a("tbody",null,[(c(!0),d(v,null,_(o(e).productos,(l,n)=>(c(),d("tr",{key:n},[a("th",L,u(n),1),a("td",null,u(l.title),1),a("td",null,u(l.price),1),a("td",null,[a("button",{onClick:D(b=>{o(e).obtenerDatoId(l.id),o(e).editar=!o(e).editar},["prevent"]),class:"btn btn-primary"}," Editar ",8,S)]),a("td",null,[a("button",{onClick:b=>o(e).eliminarDato(l.id),class:"btn btn-danger"}," Eliminar ",8,B)])]))),128))])])]))}});export{R as default};
